<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Qazi Bakers Sweets - Invoice Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--accent:#2b6cb0;--muted:#6b7280}
    body{font-family:Inter, Arial, sans-serif;margin:16px;background:#f3f4f6;color:#111}
    .app{max-width:960px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between}
    .logo{font-weight:700;font-size:20px}
    .meta{font-size:14px;text-align:right}
    .card{background:#fff;border-radius:8px;padding:14px;margin-top:12px;box-shadow:0 1px 2px rgba(0,0,0,0.06)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid #e6e6e6;text-align:left}
    th{background:#fafafa;font-weight:600}
    td.right{text-align:right}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:6px;cursor:pointer}
    button.secondary{background:#374151}
    .totals{max-width:360px;margin-left:auto;margin-top:12px}
    .totals div{display:flex;justify-content:space-between;padding:6px 0}
    .small{font-size:13px;color:var(--muted)}
    input,select{padding:6px;border:1px solid #d1d5db;border-radius:6px}
    .flex{display:flex;gap:8px}
    .grow{flex:1}
    .invoice-box{padding:18px}
    .signature{height:60px;margin-top:20px;border-top:1px dashed #ddd}/* Printable A4 layout (hidden by default) */
#printLayout{display:none}
.print-invoice{width:210mm;min-height:297mm;padding:20mm;background:#fff;margin:0 auto}
.pi-header{text-align:center;margin-bottom:8px}
.pi-header h1{margin:0;font-size:28px}
.pi-meta{font-size:13px;margin-top:6px}
.pi-table{width:100%;border-collapse:collapse;margin-top:12px}
.pi-table th, .pi-table td{border:1px solid #000;padding:6px;text-align:left}
.pi-right{text-align:right}

/* POS style */
@media print{
  body{background:#fff}
  .actions{display:none}
  .card{box-shadow:none}
}

  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">Qazi Bakers Sweets</div>
      <div class="meta">
        KLP Road, Fateh Pur Kamal (R.Y.K)<br>
        Phone: 03049152200
      </div>
    </header><div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <div class="small">Invoice No.</div>
      <input id="invoiceNo" />
    </div>
    <div>
      <div class="small">Date</div>
      <input id="invoiceDate" type="date" />
    </div>
  </div>

  <div class="invoice-box" id="invoiceBox">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <strong>Bill To:</strong><br>
        <input id="customerName" placeholder="Customer name / shop" />
      </div>
      <div style="text-align:right;font-size:12px;color:var(--muted)">
        <div>Invoice: <span id="displayInv"></span></div>
        <div>Date: <span id="displayDate"></span></div>
      </div>
    </div>

    <table id="itemsTable">
      <thead>
        <tr>
          <th style="width:36px">#</th>
          <th>Description</th>
          <th style="width:90px">Qty</th>
          <th style="width:120px">Rate</th>
          <th style="width:140px;text-align:right">Amount</th>
        </tr>
      </thead>
      <tbody id="itemsBody">
        <!-- rows inserted here -->
      </tbody>
    </table>

    <div class="actions">
      <button id="addRow">Add Item</button>
      <button class="secondary" id="clearRows">Clear Items</button>
      <button id="generatePdf">Generate A4 PDF</button>
      <button id="printBtn">Print A4</button>
      <button id="printPOS">Print Receipt (POS)</button>
    </div>

    <div class="totals">
      <div><div class="small">Subtotal</div><div class="right" id="subtotal">0.00</div></div>
      <div>
        <div class="small">Discount (flat or %)</div>
        <div class="flex" style="justify-content:flex-end;gap:6px">
          <select id="discountType"><option value="flat">Rs</option><option value="percent">%</option></select>
          <input id="discountValue" type="number" min="0" value="0" style="width:100px" />
        </div>
      </div>
      <div style="border-top:1px solid #e6e6e6;padding-top:8px;font-weight:700">
        <div style="display:flex;justify-content:space-between"><div>Grand Total</div><div id="grandTotal">0.00</div></div>
      </div>
      <div style="margin-top:8px" class="small">Amount in words: <div id="amtWords"></div></div>
    </div>

    <div class="signature small">Signature</div>
  </div>
</div>

  </div>  <!-- Hidden print layout for A4 -->  <div id="printLayout">
    <div class="print-invoice" id="piContent">
      <div class="pi-header">
        <h1>Qazi Bakers Sweets</h1>
        <div class="pi-meta">KLP Road, Fateh Pur Kamal (R.Y.K) â€” Phone: 03049152200</div>
      </div><div style="display:flex;justify-content:space-between;margin-top:12px">
    <div><strong>Bill To:</strong> <span id="piCustomer"></span></div>
    <div style="text-align:right"><strong>Invoice:</strong> <span id="piInv"></span><br><strong>Date:</strong> <span id="piDate"></span></div>
  </div>

  <table class="pi-table" id="piTable">
    <thead>
      <tr><th style="width:40px">#</th><th>Description</th><th style="width:70px">Qty</th><th style="width:90px">Rate</th><th style="width:100px">Amount</th></tr>
    </thead>
    <tbody id="piBody"></tbody>
  </table>

  <div style="max-width:360px;margin-left:auto;margin-top:12px">
    <div style="display:flex;justify-content:space-between"><div>Subtotal</div><div id="piSubtotal">0.00</div></div>
    <div style="display:flex;justify-content:space-between"><div>Discount</div><div id="piDiscount">0.00</div></div>
    <div style="display:flex;justify-content:space-between;font-weight:700;border-top:1px solid #000;padding-top:6px;margin-top:6px"><div>Grand Total</div><div id="piGrand">0.00</div></div>
    <div style="margin-top:8px">Amount (in words): <div id="piWords"></div></div>
  </div>

  <div style="margin-top:20px">Signature: ____________________</div>
</div>

  </div>  <!-- Libraries for PDF generation -->  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>  <script>
    // Elements
    const itemsBody = document.getElementById('itemsBody');
    const subtotalEl = document.getElementById('subtotal');
    const grandTotalEl = document.getElementById('grandTotal');
    const discountType = document.getElementById('discountType');
    const discountValue = document.getElementById('discountValue');
    const amtWords = document.getElementById('amtWords');
    const invoiceNo = document.getElementById('invoiceNo');
    const invoiceDate = document.getElementById('invoiceDate');
    const displayInv = document.getElementById('displayInv');
    const displayDate = document.getElementById('displayDate');

    // Print layout elements
    const piCustomer = document.getElementById('piCustomer');
    const piInv = document.getElementById('piInv');
    const piDate = document.getElementById('piDate');
    const piBody = document.getElementById('piBody');
    const piSubtotal = document.getElementById('piSubtotal');
    const piDiscount = document.getElementById('piDiscount');
    const piGrand = document.getElementById('piGrand');
    const piWords = document.getElementById('piWords');

    // Auto-generate invoice number (default) - you can still edit
    function genInvoiceNo(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      const rand = Math.floor(Math.random()*9000)+1000;
      return `INV-${y}${m}${day}-${rand}`;
    }

    function setToday(){
      const d = new Date();
      invoiceDate.value = d.toISOString().slice(0,10);
      displayDate.textContent = invoiceDate.value;
      invoiceNo.value = genInvoiceNo();
      displayInv.textContent = invoiceNo.value;
    }

    invoiceNo.addEventListener('input', ()=> displayInv.textContent = invoiceNo.value);
    invoiceDate.addEventListener('change', ()=> displayDate.textContent = invoiceDate.value);
    setToday();

    function addRow(desc='', qty=1, rate=0){
      const idx = itemsBody.children.length + 1;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${idx}</td>
        <td><input class="desc" value="${desc}" placeholder="Item description" style="width:100%"/></td>
        <td><input class="qty" type="number" min="0" value="${qty}" style="width:80px"/></td>
        <td><input class="rate" type="number" min="0" value="${rate}" style="width:110px"/></td>
        <td class="right amountCell">0.00</td>
      `;
      itemsBody.appendChild(tr);

      tr.querySelectorAll('input').forEach(inp=>inp.addEventListener('input', calculate));
      calculate();
    }

    document.getElementById('addRow').addEventListener('click', ()=> addRow());
    document.getElementById('clearRows').addEventListener('click', ()=>{ itemsBody.innerHTML=''; calculate(); });

    function calculate(){
      let subtotal = 0;
      Array.from(itemsBody.children).forEach((tr,i)=>{
        const q = parseFloat(tr.querySelector('.qty')?.value || 0);
        const r = parseFloat(tr.querySelector('.rate')?.value || 0);
        const amt = +(q*r).toFixed(2);
        tr.querySelector('.amountCell').textContent = amt.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
        subtotal += amt;
        tr.querySelector('td:first-child').textContent = i+1;
      });
      subtotal = +subtotal.toFixed(2);
      subtotalEl.textContent = subtotal.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});

      // discount
      let disc = parseFloat(discountValue.value || 0);
      if(discountType.value === 'percent'){
        disc = subtotal * disc / 100;
      }
      disc = Math.min(disc, subtotal);
      const grand = +(subtotal - disc).toFixed(2);
      grandTotalEl.textContent = grand.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});

      amtWords.textContent = toWords(grand) + ' rupees only.';
    }

    discountType.addEventListener('change', calculate);
    discountValue.addEventListener('input', calculate);

    // number to english words (simple)
    function toWords(num){
      if(num===0) return 'zero';
      const a = ['','one','two','three','four','five','six','seven','eight','nine','ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'];
      const b = ['','','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'];
      function inWords(n){
        if(n<20) return a[n];
        if(n<100) return b[Math.floor(n/10)] + (n%10?'-'+a[n%10]:'');
        if(n<1000) return a[Math.floor(n/100)] + ' hundred' + (n%100? ' ' + inWords(n%100):'');
        if(n<100000) return inWords(Math.floor(n/1000)) + ' thousand' + (n%1000? ' ' + inWords(n%1000):'');
        if(n<10000000) return inWords(Math.floor(n/100000)) + ' lakh' + (n%100000? ' ' + inWords(n%100000):'');
        return inWords(Math.floor(n/10000000)) + ' crore' + (n%10000000? ' ' + inWords(n%10000000):'');
      }
      const intPart = Math.floor(num);
      const frac = Math.round((num - intPart) * 100);
      return inWords(intPart) + (frac? ' and ' + frac + '/100':'' );
    }

    // Populate printable A4 layout from data
    function buildPrintLayout(){
      // header fields
      piCustomer.textContent = document.getElementById('customerName').value || '';
      piInv.textContent = invoiceNo.value;
      piDate.textContent = invoiceDate.value;

      // table
      piBody.innerHTML = '';
      let subtotal = 0;
      Array.from(itemsBody.children).forEach((tr,i)=>{
        const desc = tr.querySelector('.desc').value || '';
        const q = parseFloat(tr.querySelector('.qty').value || 0);
        const r = parseFloat(tr.querySelector('.rate').value || 0);
        const amt = +(q*r).toFixed(2);
        subtotal += amt;
        const row = document.createElement('tr');
        row.innerHTML = `<td>${i+1}</td><td>${desc}</td><td>${q}</td><td>${r.toFixed(2)}</td><td>${amt.toFixed(2)}</td>`;
        piBody.appendChild(row);
      });
      subtotal = +subtotal.toFixed(2);
      piSubtotal.textContent = subtotal.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});

      let disc = parseFloat(discountValue.value || 0);
      if(discountType.value === 'percent') disc = subtotal * disc / 100;
      disc = Math.min(disc, subtotal);
      piDiscount.textContent = disc.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});

      const grand = +(subtotal - disc).toFixed(2);
      piGrand.textContent = grand.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
      piWords.textContent = toWords(grand) + ' rupees only.';
    }

    // A4 PDF generation using html2canvas + jsPDF
    document.getElementById('generatePdf').addEventListener('click', async ()=>{
      buildPrintLayout();
      const el = document.getElementById('piContent');
      // temporarily show element to render accurately
      document.getElementById('printLayout').style.display = 'block';
      await new Promise(r=>setTimeout(r,100));
      const canvas = await html2canvas(el, {scale:2});
      document.getElementById('printLayout').style.display = 'none';
      const imgData = canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p','pt','a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const imgWidth = pageWidth - 40;
      const imgHeight = canvas.height * (imgWidth / canvas.width);
      pdf.addImage(imgData, 'PNG', 20, 20, imgWidth, imgHeight);
      pdf.save((invoiceNo.value || 'invoice') + '.pdf');
    });

    // Print A4
    document.getElementById('printBtn').addEventListener('click', ()=>{
      buildPrintLayout();
      const win = window.open('', '_blank');
      win.document.write('<html><head><title>Invoice</title>');
      win.document.write('<style>body{font-family:Arial, sans-serif;padding:20px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #000;padding:6px;text-align:left}</style>');win.document.write('</head><body>');
  win.document.write(document.getElementById('piContent').outerHTML);
  win.document.write('</body></html>');
  win.document.close();
  win.focus();
  setTimeout(()=>{win.print(); win.close();},500);
});

// POS receipt print (small thermal-friendly)
document.getElementById('printPOS').addEventListener('click', ()=>{
  // build simple receipt HTML
  let receipt = '';
  receipt += '<div style="font-family:monospace;width:280px">';
  receipt += '<h2 style="text-align:center;margin:6px 0">Qazi Bakers Sweets</h2>';
  receipt += '<div style="text-align:center">KLP Road, Fateh Pur Kamal (R.Y.K)<br>Phone: 03049152200</div>';
  receipt += '<hr>';
  receipt += `<div>Invoice: ${invoiceNo.value} <br> Date: ${invoiceDate.value}</div>`;
  receipt += '<table style="width:100%;font-size:13px;border-collapse:collapse;margin-top:6px">';
  receipt += '<thead><tr><th style="text-align:left">Item</th><th style="text-align:right">Amt</th></tr></thead><tbody>';
  let subtotal = 0;
  Array.from(itemsBody.children).forEach((tr,i)=>{
    const desc = tr.querySelector('.desc').value || '';
    const q = parseFloat(tr.querySelector('.qty').value || 0);
    const r = parseFloat(tr.querySelector('.rate').value || 0);
    const amt = +(q*r).toFixed(2);
    subtotal += amt;
    receipt += `<tr><td style="text-align:left">${desc} x${q}</td><td style="text-align:right">${amt.toFixed(2)}</td></tr>`;
  });
  let disc = parseFloat(discountValue.value || 0);
  if(discountType.value === 'percent') disc = subtotal * disc / 100;
  disc = Math.min(disc, subtotal);
  const grand = +(subtotal - disc).toFixed(2);

  receipt += '</tbody></table>';
  receipt += '<hr>';
  receipt += `<div style="display:flex;justify-content:space-between"><div>Subtotal</div><div>${subtotal.toFixed(2)}</div></div>`;
  receipt += `<div style="display:flex;justify-content:space-between"><div>Discount</div><div>${disc.toFixed(2)}</div></div>`;
  receipt += `<div style="display:flex;justify-content:space-between;font-weight:700"><div>Total</div><div>${grand.toFixed(2)}</div></div>`;
  receipt += `<div style="margin-top:6px">Amount in words: ${toWords(grand)} rupees only.</div>`;
  receipt += '<div style="margin-top:12px;text-align:center">Thank you</div>';
  receipt += '</div>';

  const w = window.open('', 'posprint');
  w.document.write('<html><head><title>Receipt</title></head><body>');
  w.document.write(receipt);
  w.document.write('</body></html>');
  w.document.close();
  setTimeout(()=>{w.print(); w.close();},400);
});

// initial sample rows
addRow('Milk Pak Cream',48,221.79);
addRow('Everday 396*13g',24,29.00);
addRow('Bunyad 260g',4,524.57);
calculate();

  </script>
</body>
</html>